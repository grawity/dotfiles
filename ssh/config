# vim: ft=sshconfig
# Target version: 8.4 (Debian buster-backports)
# NOTE: The '#if' directives are processed by the 'ssh/generate' script, not OpenSSH.

# Doesn't yet exist in Debian bullseye (OpenSSH 8.4)
IgnoreUnknown PubkeyAcceptedAlgorithms

Host blizzard.nullroute.lt
	User mantas

Host dune.nullroute.lt
	User root

#if star
# Use direct IPv4 peering with better throughput (~900 Mbps IPv4 vs ~220 Mbps IPv6)
Host ember.nullroute.lt
	AddressFamily inet
Host wind.nullroute.lt
	AddressFamily inet
#elif @(ember|wind|frost)
# Use direct IPv4 peering with better throughput (~900 Mbps IPv4 vs ~220 Mbps IPv6)
Host star.nullroute.lt
	AddressFamily inet
#endif

#if @(rain|midnight|myth)
Host vm-vol5 vm-vol5.nullroute.lt
	# Use native IPv4 (even if it involves NAT) instead of tunneling, for throughput
	HostkeyAlias vm-vol5.nullroute.lt
	HostName ext.vm-vol5.nullroute.lt
	Port 56378
#endif

Host ember-alt ember-bypass
	# Direct uplink to sw-b56-edge that bypasses gw-core
	HostkeyAlias ember.nullroute.lt
	HostName alt.ember.nullroute.lt
	PKCS11Provider none

Host wind-alt
	# Alternative path to core via PTP-U2
	HostkeyAlias wind.nullroute.lt
	HostName alt.wind.nullroute.lt
	PKCS11Provider none

#if ember
Host embergw-alt
	HostName 10.147.241.58
	HostkeyAlias embergw.nullroute.lt
#endif

Host gate gate.nullroute.lt
	HostkeyAlias gate.nullroute.lt
	HostName sky.nullroute.lt
	VerifyHostKeyDNS no
	User _gate
	Port 2

Host vm-ampere.nullroute.lt vm-ampere.sym
	# Experimenting with HOME=/net/land/home/grawity
	PreferredAuthentications gssapi-with-mic
	GSSAPIDelegateCredentials yes

Host dust.nullroute.lt dust.sym
	PreferredAuthentications gssapi-with-mic
	GSSAPIDelegateCredentials yes

Host bmc.*.nullroute.lt bmc.*.sym
	# iLO (import public key in "SSH2" format)
	KexAlgorithms +diffie-hellman-group14-sha1
	HostKeyAlgorithms +ssh-rsa
	PubkeyAcceptedAlgorithms +ssh-rsa
	User Administrator

Host ptp-u2*.sym ptp-pico*.sym kol-*.sym
	KexAlgorithms +diffie-hellman-group1-sha1
	HostKeyAlgorithms +ssh-rsa
	PubkeyAcceptedAlgorithms +ssh-rsa
	User root

Host *.nullroute.lt *.sym
	GSSAPIAuthentication yes
	ForwardAgent yes

# -- Other hosts --

Host aur
	HostName aur.archlinux.org
	User aur

Host shell.*.burble.dn42
	User nullroute

Host burble-ca
	HostName shell.ca-bhs2.burble.dn42

Host burble-fr
	HostName shell.fr-par1.burble.dn42

Host burble-us
	HostName shell.us-lax1.burble.dn42

Host eisner
	HostName %h.encompasserve.org
	HostKeyAlgorithms +ssh-rsa
	PubkeyAcceptedAlgorithms +ssh-rsa
	User mikulenas

Host grex grex.org
	HostName grex.org
	ServerAliveInterval 20s

Host m-net m-net.arbornet.org
	HostName m-net.arbornet.org
	ServerAliveInterval 20s

Host sdf sdf.org
	HostName tty.sdf.org

Host sdf-eu sdf.eu
	HostName sdf-eu.org

Host theos
	HostName %h.kyriasis.com

Host vsiftp.vmssoftware.com
	User VSIPUBLIC
	HostKeyAlgorithms +ssh-rsa

# -- Work --

Host uk-lnx1-console
	# Serial port through AP-M7-14
	HostName 10.34.1.14
	HostkeyAlias ap-m7-14.utenos-kolegija.lt
	User cons
	PKCS11Provider p11-kit-proxy.so

Host gw-core-alt
#if ember
	HostName 2001:778:0:1025::2
	BindAddress 2001:778:0:1025::3
#else
	HostName 83.171.33.188
	ProxyJump sky
#endif
	HostkeyAlias gw-core.utenos-kolegija.lt
	User root
	PKCS11Provider p11-kit-proxy.so

Host *.utenos-kolegija.lt
	PKCS11Provider p11-kit-proxy.so

Host gw-b56.utenos-kolegija.lt gw-m18.utenos-kolegija.lt
	# RouterOS 6.48.3 seems to support RSA-SHA2 for host keys, but still doesn't
	# accept such signatures for user keys. (XXX: Fixed in ROS 7.4beta2?)
	PubkeyAcceptedAlgorithms +ssh-rsa

# -- Global settings --

Host ubnt
	HostName 192.168.1.20
	User ubnt
	UserKnownHostsFile /dev/null
	GlobalKnownHostsFile /dev/null
	StrictHostKeyChecking no
	ControlPersist no

Match canonical host *.*
	# Disable GSSAPI for FQDNs that aren't our own
	GSSAPIAuthentication no

Match canonical host *
	# ...but enable it for single-label names
	GSSAPIAuthentication yes

#if @(rain|midnight|myth|fujitsu)
Host *
	# Prioritize connections over .sym WireGuard, so that 'ssh ember' could
	# use the lower-latency path via star, and would remain uninterrupted
	# when wg-uk is brought up or down.
	CanonicalDomains sym nullroute.lt

Match canonical host *.sym
	#TCPKeepAlive no

Match canonical host *,!*.sym
	# Telia's LTE CGNAT has an aggressive idle timeout (several minutes),
	# so make sure to expire old connections when resuming from sleep.
	ServerAliveInterval 10s
#endif

#if @(ember|wind)
# On hosts where NAT timeouts are not an issue, persist authenticated
# connections for longer.
Host *
	ControlPersist 1h
#else
Host *
	ControlPersist 15s
#endif

#if @(ember|frost|midnight)
Host *.* homegw !ember !*.nullroute.lt
	PKCS11Provider p11-kit-proxy.so

Host dune.nullroute.lt
	PKCS11Provider p11-kit-proxy.so
#endif

Host *
	CanonicalizeHostname yes
#if @(ember|wind|frost)
	CanonicalDomains nullroute.lt utenos-kolegija.lt ukolegija.lt
#else
	CanonicalDomains nullroute.lt
#endif
	Protocol 2
	HashKnownHosts no
	VerifyHostKeyDNS yes
	SendEnv LANG TZ
	ControlPath ~/.ssh/S.%r@%h:%p
	ControlMaster auto

	# This defaults to 'no' on new versions, but still 'yes' on Debian's 8.4
	CheckHostIP no
